{% extends 'base.html' %}
{% load static %}
{% block title %}Contacts - {{ organization.name }}{% endblock %}
{% block content %}
<div class="container py-4">
    <a href="{% url 'org_dashboard' organization.slug %}" class="btn btn-link">‚Üê Back</a>
    <h1 class="mb-3">Contacts for {{ organization.name }}</h1>
    {% if message %}
        <div class="alert alert-info">{{ message }}</div>
    {% endif %}

    <div class="row mt-3">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">Existing Contacts</div>
                <div class="card-body">
                    {% if contacts %}
                        <table class="table table-sm">
                            <thead>
                                <tr><th>Name</th><th>Phone</th><th class="text-end">Actions</th></tr>
                            </thead>
                            <tbody>
                                {% for c in contacts %}
                                    <tr>
                                        <td>{{ c.name }}</td>
                                        <td>{{ c.phone_number }}</td>
                                        <td class="text-end">
                                            <form method="post" class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="edit_contact">
                                                <input type="hidden" name="contact_id" value="{{ c.id }}">
                                                <button class="btn btn-sm btn-outline-secondary" formaction="?edit={{ c.id }}">Edit</button>
                                            </form>
                                            <form method="post" class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="action" value="delete_contact">
                                                <input type="hidden" name="contact_id" value="{{ c.id }}">
                                                <button class="btn btn-sm btn-danger" onclick="return confirm('Delete contact?')">Delete</button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% else %}
                        <p>No contacts yet. Use the add form or paste a list to import quickly.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Add / Edit Contact</div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="add_contact">
                        {% if edit_contact %}
                            <input type="hidden" name="contact_id" value="{{ edit_contact.id }}">
                        {% endif %}
                        <div class="mb-2">
                            <label class="form-label">Name</label>
                            <input name="name" class="form-control" value="{{ edit_contact.name|default_if_none:'' }}">
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Phone</label>
                            <input name="phone" class="form-control" value="{{ edit_contact.phone_number|default_if_none:'' }}" placeholder="+233... or 055...">
                        </div>
                        <button class="btn btn-primary">Save contact</button>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Paste contacts (one per line: name, phone)</div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="paste_contacts">
                        <div class="mb-2">
                            <textarea name="pasted" rows="6" class="form-control" placeholder="John Doe, +233555000111\nJane, 0555000222"></textarea>
                        </div>
                        <button class="btn btn-outline-primary">Import pasted contacts</button>
                    </form>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">Upload File</div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="upload_file">
                        <div class="mb-2">
                            <input type="file" name="contacts_file" class="form-control">
                        </div>
                        <button class="btn btn-primary">Upload</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
